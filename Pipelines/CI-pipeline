pipeline {
    agent any
     environment {
        DOCKER_USERNAME = "ashutosh"
    }
    stages {
	
        stage('Cleanup') {
            // Clean workspace directory for the current build
            steps {
                deleteDir ()             
            }
        }
		
		stage('Git Checkout') {
            steps {
                git 'https://github.com/Ash0497/express.git'
            }
        }
		stage('Install Dependencies') {
            steps {
                sh 'npm install'
            }
        }
		stage('Run Test'){
		     steps {
			     sh 'npm test'
			}
		}
        stage('build docker image ') {
            steps {
                      sh 'docker build -t ${JOB_NAME}:${BUILD_NUMBER} . '
                
            }
        }
		stage('Tag image'){
		     steps {
			     script {
                    def JOB = env.JOB_NAME.toLowerCase()
                    sh "docker tag ${JOB}:${BUILD_NUMBER} ${DOCKER_USERNAME}/${JOB}:v${BUILD_NUMBER}"
                    sh "docker tag ${JOB}:${BUILD_NUMBER} ${DOCKER_USERNAME}/${JOB}:latest"
                  } 
			}
		}
    }
}

